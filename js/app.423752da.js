(function(){var t={1638:function(t,e,a){"use strict";var o=a(9242),s=a(3396);const r=(0,s._)("h1",null,"SpotifyAtlas",-1);function i(t,e,a,o,i,n){const l=(0,s.up)("router-view");return(0,s.wg)(),(0,s.iD)(s.HY,null,[r,(0,s.Wm)(l)],64)}var n={name:"App",components:{}},l=a(89);const c=(0,l.Z)(n,[["render",i]]);var u=c,h=a(6602),p=a(7139);const m={key:0},d=(0,s.Uk)("Login"),g={key:1},y=(0,s.Uk)("Logout"),f=(0,s.Uk)("Last 4 Weeks"),k=(0,s.Uk)("Last 6 Months"),D=(0,s.Uk)("All Time"),w={key:0},v={key:0};function b(t,e,a,o,r,i){const n=(0,s.up)("n-button"),l=(0,s.up)("n-space"),c=(0,s.up)("n-progress"),u=(0,s.up)("n-card"),h=(0,s.up)("n-modal"),b=(0,s.up)("GChart"),C=(0,s.up)("n-grid-item"),A=(0,s.up)("n-grid");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("h3",null,(0,p.zw)(r.dataFilterTitle),1),i.isAuth()?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",m,[(0,s.Wm)(n,{onClick:i.LoginToSpotify},{default:(0,s.w5)((()=>[d])),_:1},8,["onClick"])])),i.isAuth()?((0,s.wg)(),(0,s.iD)("div",g,[(0,s.Wm)(l,{vertical:""},{default:(0,s.w5)((()=>[(0,s.Wm)(n,{onClick:i.logout,type:"error"},{default:(0,s.w5)((()=>[y])),_:1},8,["onClick"]),(0,s.Wm)(l,{justify:"center"},{default:(0,s.w5)((()=>[(0,s.Wm)(n,{tertiary:"",type:"primary",onClick:e[0]||(e[0]=t=>i.grabUserTopItems("short_term"))},{default:(0,s.w5)((()=>[f])),_:1}),(0,s.Wm)(n,{tertiary:"",type:"primary",onClick:e[1]||(e[1]=t=>i.grabUserTopItems("medium_term"))},{default:(0,s.w5)((()=>[k])),_:1}),(0,s.Wm)(n,{tertiary:"",type:"primary",onClick:e[2]||(e[2]=t=>i.grabUserTopItems("long_term"))},{default:(0,s.w5)((()=>[D])),_:1})])),_:1})])),_:1}),(0,s.Wm)(h,{show:r.showLoadingModal},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{style:{width:"500px"},title:"Loading Data",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{type:"line",percentage:r.currPercentage,"indicator-placement":"inside",processing:""},null,8,["percentage"])])),_:1})])),_:1},8,["show"]),null!=r.TopItemsArray&&100==r.currPercentage?((0,s.wg)(),(0,s.iD)("div",w,[(0,s.Wm)(A,{"x-gap":"12",cols:"1 s:1 m:2 l:2 xl:2 2xl:2",responsive:"screen"},{default:(0,s.w5)((()=>[(0,s.Wm)(C,null,{default:(0,s.w5)((()=>[(0,s._)("div",null,[(0,s.Wm)(b,{settings:{packages:["geochart"]},createChart:(t,e)=>new e.visualization.GeoChart(t),type:"GeoChart",data:r.TopItemsArray,events:r.geoChartEvents,onReady:i.onChartReady},null,8,["createChart","data","events","onReady"])])])),_:1}),(0,s.Wm)(C,null,{default:(0,s.w5)((()=>[null!=r.artistsLookup&&1==r.isCountryDataDone?((0,s.wg)(),(0,s.iD)("div",v,[(0,s.Wm)(b,{settings:{packages:["table"]},type:"Table",data:r.artistsLookup,onReady:i.loadCountryPieChart,options:r.tableOptions},null,8,["data","onReady","options"])])):(0,s.kq)("",!0)])),_:1})])),_:1})])):(0,s.kq)("",!0)])):(0,s.kq)("",!0)],64)}a(2801),a(8675),a(3462),a(7380),a(1118);var C=a(2679),A=a(8281),T=a(5006),_=a(9522),I=a(7672),L=a(5210),P=a(5941),x=a(6265),$=a.n(x),S=a(5410),W=a.n(S),M=a(739),O={name:"SpotifyData",components:{NButton:C.Z,NProgress:A.Z,NModal:T.Z,NCard:_.ZP,NGrid:I.Z,NGridItem:L.ZP,NSpace:P.Z,GChart:M.PQ},methods:{LoginToSpotify(){console.log("Logging in to Spotify"),window.location.href="https://accounts.spotify.com/authorize?"+W().stringify({client_id:"203cf6804ed64da2accc7f84ede9118c",response_type:"code",redirect_uri:this.$spotifyRedirectURL,scope:"user-top-read playlist-read-private user-read-private",state:this.$cookies.get("vueState"),code_challenge_method:"S256",code_challenge:this.spotifySHA})},pause(){return new Promise((t=>setTimeout((()=>{t()}),700)))},loadCountryPieChart(t,e){const a=e.visualization.arrayToDataTable(this.artistsLookup),o={sortColumn:2,sortAscending:!1};console.log(o),this.geoPieChart?this.geoPieChart.draw(a,o):(t.draw(a,o),this.geoPieChart=t),console.log(this.geoPieChart),this.isCountryDataDone=!0},getCountryPieChartData(t){this.artistsLookup=null,this.isCountryDataDone=!1,console.log(this.sourceData[t]);const e=[];Object.entries(this.sourceData[t]).forEach((function([t,a]){console.log(t),e.push([a.name,a.genres.length,a.popularity,a.genres.join(", ")])}));const a=[["Artist","Number of Generes","Popularity","Generes"]];a.push(...e),console.log(a),this.artistsLookup=a,null!==this.geoPieChart?this.loadCountryPieChart(this.geoPieChart,this.chartsLib):this.isCountryDataDone=!0},async grabUserTopItems(t){let e=!1;switch(t){case"medium_range":this.dataFilterTitle="Last 6 Months",e=null==this.sixMonthsData;break;case"short_term":this.dataFilterTitle="Last 4 Weeks",e=null==this.fourWeeksData;break;case"long_term":this.dataFilterTitle="All Time",e=null==this.allTImesData;break;default:this.dataFilterTitle="Last 6 Months",e=null==this.sixMonthsData;break}if(e){this.showLoadingModal=!0,this.currPercentage=0,this.userTopItems={},this.sourceData={};const e=await this.spotifyAxios.get("me/top/artists",{params:{limit:50,time_range:`${t}`}});let a=null,o="";for(let t=0;t<e.data.items.length;t++)a=await this.musicAxios.get("",{params:{fmt:"json",query:e.data.items[t].name}}),null!=a.data.artists[0].area&&"Country"===a.data.artists[0].area.type&&(o=a.data.artists[0].area.name,null==this.sourceData[o]?this.sourceData[o]=[{name:e.data.items[t].name,genres:e.data.items[t].genres,popularity:e.data.items[t].popularity}]:this.sourceData[o].push({name:e.data.items[t].name,genres:e.data.items[t].genres,popularity:e.data.items[t].popularity}),null==this.userTopItems[o]?this.userTopItems[o]=1:this.userTopItems[o]+=1),this.currPercentage=t/(e.data.items.length-1)*100,await this.pause();const s=[["Country","Count"]];switch(s.push(...Object.entries(this.userTopItems)),this.TopItemsArray=s,t){case"medium_range":this.sixMonthsData={topItemsArray:this.TopItemsArray,sourceData:this.sourceData};break;case"short_term":this.fourWeeksData={topItemsArray:this.TopItemsArray,sourceData:this.sourceData};break;case"long_term":this.allTImesData={topItemsArray:this.TopItemsArray,sourceData:this.sourceData};break;default:this.sixMonthsData={topItemsArray:this.TopItemsArray,sourceData:this.sourceData};break}}else{switch(t){case"medium_range":this.TopItemsArray=this.sixMonthsData.topItemsArray,this.sourceData=this.sixMonthsData.sourceData;break;case"short_term":this.TopItemsArray=this.fourWeeksData.topItemsArray,this.sourceData=this.fourWeeksData.sourceData;break;case"long_term":this.TopItemsArray=this.allTImesData.topItemsArray,this.sourceData=this.allTImesData.sourceData;break;default:this.TopItemsArray=this.sixMonthsData.topItemsArray,this.sourceData=this.sixMonthsData.sourceData;break}this.artistsLookup=null}this.showLoadingModal=!1,this.isDone=!0},generateRandomString(t){let e="";const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.~";for(let o=0;o<t;o++)e+=a.charAt(Math.floor(Math.random()*a.length));return e},async SHA256(t){const e=new TextEncoder,a=e.encode(t),o=window.crypto.subtle.digest("SHA-256",a);return btoa(String.fromCharCode(...new Uint8Array(o))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},async onChartReady(t,e){if(this.TopItemsArray){const a=e.visualization.arrayToDataTable(this.TopItemsArray);this.chartsLib=e,t.draw(a,{}),this.geoChart=t}},isAuth(){return null!=this.$cookies.get("access_token")&&null!=this.$cookies.get("exprDate")&&new Date(this.$cookies.get("exprDate"))>=new Date},logout(){this.$cookies.remove("access_token"),this.$cookies.remove("exprDate"),this.$cookies.remove("shaVer"),this.$cookies.remove("vueState"),window.location.reload()}},data(){return{userTopItems:null,allTImesData:null,sixMonthsData:null,fourWeeksData:null,showLoadingModal:!1,TopItemsArray:null,spotifySHA:null,spotifyAxios:null,dataFilterTitle:"",musicAxios:null,cityLookupAxios:null,isDone:!1,isCountryDataDone:!1,chartsLib:null,chartTemp:null,sourceData:null,artistsLookup:null,tableOptions:{sortColumn:2,sortAscending:!1},currPercentage:0,geoChart:null,geoPieChart:null,geoChartEvents:{select:()=>{const t=this.geoChart.getSelection();if(void 0!==t[0]){console.log(t[0].row+1),this.artistsLookup=null;const e=t[0].row+1,a=this.TopItemsArray[e][0];console.log(this.TopItemsArray[e][0]),this.isCountryDataDone=!1,this.getCountryPieChartData(a)}}}}},mounted(){const t=this.generateRandomString(16),e=this.generateRandomString(Math.floor(85*Math.random()+43));console.log(e),this.spotifySHA=this.SHA256(e),console.log(this.spotifySHA),this.$cookies.set("shaVer",e),this.$cookies.set("vueState",t),this.isAuth()?(console.log("ISAUTH"),this.spotifyAxios=$().create({baseURL:"https://api.spotify.com/v1/",headers:{Authorization:`Bearer ${this.$cookies.get("access_token")}`}}),this.cityLookupAxios=$().create({baseURL:"https://countriesnow.space/api/v0.1/countries/population/cities"}),this.musicAxios=$().create({baseURL:"https://musicbrainz.org/ws/2/artist/"})):(this.$cookies.remove("access_token"),this.$cookies.remove("exprDate"),this.$cookies.remove("shaVer"),this.$cookies.remove("vueState")),console.log("production")},computed:{chartOptions(){return this.chartsLib?{title:"Geograph Data",pieHole:.4,tooltip:{trigger:"selection"},width:800,height:600}:null}}};const R=(0,l.Z)(O,[["render",b]]);var U=R;function H(t,e,a,o,r,i){return(0,s.wg)(),(0,s.iD)("h1",null,"Callback")}var j={async mounted(){console.log(this.$route.query);const t=this.$route.query.state;if(null==t||t!==this.$cookies.get("vueState")){const t="HomeProd";this.$router.push({name:t})}const e=await $()({method:"POST",data:W().stringify({grant_type:"authorization_code",code:this.$route.query.code,redirect_uri:this.$spotifyRedirectURL,client_id:"203cf6804ed64da2accc7f84ede9118c",code_verifier:this.$cookies.get("shaVer")}),url:"https://accounts.spotify.com/api/token",headers:{"content-type":"application/x-www-form-urlencoded",Authorization:"Basic "+btoa("203cf6804ed64da2accc7f84ede9118c:3c0043a696804f0a9003ff93164d372d")}});this.$cookies.set("access_token",e.data.access_token);let a=new Date;if(a=new Date(a.getTime()+1e3*e.data.expires_in),this.$cookies.set("exprDate",a.toString()),null!==e.data){const t="HomeProd";this.$router.go({name:t})}console.log(e)}};const Z=(0,l.Z)(j,[["render",H]]);var q=Z;const z=[{path:"/",name:"Home",component:U},{path:"/spotifyatlas/",name:"HomeProd",component:U},{path:"/callback/:queryParams(.*)",name:"CallbackView",component:q},{path:"/spotifyatlas/callback/:queryParams(.*)",name:"CallbackViewProd",component:q}],G=(0,h.p7)({mode:"history",history:(0,h.PO)(),routes:z});var N=G,F=a(8541),V=a(7979);a(5113);const E=(0,o.ri)(u);E.config.globalProperties.$spotifyRedirectURL="https://anjolaolubusi.github.io/spotifyatlas/callback/",E.use(N).use(F.ZP).use(V.Z).mount("#app")},4654:function(){}},e={};function a(o){var s=e[o];if(void 0!==s)return s.exports;var r=e[o]={exports:{}};return t[o].call(r.exports,r,r.exports,a),r.exports}a.m=t,function(){var t=[];a.O=function(e,o,s,r){if(!o){var i=1/0;for(u=0;u<t.length;u++){o=t[u][0],s=t[u][1],r=t[u][2];for(var n=!0,l=0;l<o.length;l++)(!1&r||i>=r)&&Object.keys(a.O).every((function(t){return a.O[t](o[l])}))?o.splice(l--,1):(n=!1,r<i&&(i=r));if(n){t.splice(u--,1);var c=s();void 0!==c&&(e=c)}}return e}r=r||0;for(var u=t.length;u>0&&t[u-1][2]>r;u--)t[u]=t[u-1];t[u]=[o,s,r]}}(),function(){a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,{a:e}),e}}(),function(){a.d=function(t,e){for(var o in e)a.o(e,o)&&!a.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};a.O.j=function(e){return 0===t[e]};var e=function(e,o){var s,r,i=o[0],n=o[1],l=o[2],c=0;if(i.some((function(e){return 0!==t[e]}))){for(s in n)a.o(n,s)&&(a.m[s]=n[s]);if(l)var u=l(a)}for(e&&e(o);c<i.length;c++)r=i[c],a.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return a.O(u)},o=self["webpackChunkspotifyatlas"]=self["webpackChunkspotifyatlas"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=a.O(void 0,[998],(function(){return a(1638)}));o=a.O(o)})();
//# sourceMappingURL=app.423752da.js.map